{% extends 'classbooking_app/base.html' %}

{% block contentbody %}
<h1>Your Bookings</h1>
<form method="POST" id="cancel-form">
    {% csrf_token %}
    <label class="invisible" for="cancel">Cancel Booking:</label>
    <input class="invisible" type="text" id="cancel" name="cancel" value="{{ cancel_id }}">
{% if bookings|length > 0 %}
<div class="container">
 <div class="row">
   <div class="col">Activity</div>
   <div class="col">Date</div>
   <div class="col">Time</div>
   <div class="col">Location</div>
   <div class="col"></div>
 </div>
 {% for booking in bookings %}
 <div class="row run-{{ booking.session.running }}">
   <div class="col">{{ booking.session.activity.name }}</div>
   <div class="col">{{ booking.session.date }}</div>
   <div class="col">{{ booking.session.time | time:"G:i" }}</div>
   <div class="col">{{ booking.session.location }}</div>
   <div class="col">
    {% if booking.session.running == False %}
    <div>Apologies, the gym has had to cancel this class.</div>
    {% else %}
     <input class="cancel-button run-{{ booking.session.running }}-btn" type="button" value="Cancel Booking" id="{{ booking.session.id }}-view" data-toggle="modal" data-target="#modal-{{ booking.session.id }}">
    {% endif %}
    </div>
 </div>
</div>
</form>  
<!-- Modal -->
<div class="modal fade" id="modal-{{ booking.session.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="modal-header-{{ booking.session.id }}" class="modal-title"
        >Are you sure you want to cancel 
        {{booking.session.activity.name}} 
        at {{ booking.session.time }}
        on {{ booking.session.date }}?
      </h5>
      </div>
      <div class="modal-body">
        <button id="{{ booking.session.id }}-yes" type="button" class="confirm-cancel btn btn-secondary">Yes</button>
        <button id="{{ booking.session.id }}-no" type="button" class="btn btn-primary" data-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>

<button type="button" id="confirm-modal-btn" data-toggle="modal" data-target="#confirm-modal" class="invisible"></button>
<div class="modal fade" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 id="confirm-modal-header" class="modal-title">
        Thank you. Your booking for {{ cancelled_session.activity.name }} at {{ cancelled_session.time }} on {{ cancelled_session.date }} has been cancelled.
      </h5>
      </div>
      <div class="modal-body">
        <a class="nav-link" href="/timetable.html" id="timetable-link">
          <button id="{{ booking.session.id }}-yes" type="button" class="confirm-cancel btn btn-secondary">
            Book more classes
          </button>
        </a>
        <button id="{{ booking.session.id }}-no" type="button" class="btn btn-primary" data-dismiss="modal">View remaining bookings</button>
      </div>
    </div>
  </div>
</div>
{% endfor %}

{% else %}
<p>
  You aren't booked into any classes yet, visit the <a href="/timetable.html" id="timetable-link">Timetable</a> to book yourself in.
</p>
{% endif %}
{% endblock %}

{% block contentscript %}  
<script src="../../static/classbooking_app/js/view_bookings.js?2"></script>
{% endblock %}

