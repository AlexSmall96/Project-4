{% extends 'classbooking_app/base.html' %}

{% block contentbody %}
<form method="POST" id="session-form">
<div  class="beneath-header" id="admin-instructions">
<h3><i class="fa-solid fa-circle-exclamation"></i> This page is for Admin use only:</h3>
<ul>
 <li>Use the below filters to load sessions.</li>
 <li>Use the date, activity and location filters below to view sessions. By default, the timetable for the next month is shown. Press the filter icons that appear above to unfilter that field.</li>
 <li>For any session shown, alter the fields as required and press 'Save Session Changes' and press confirm on the popup. Altering information without pressing save WILL NOT update the</li>
 <li>To delete a session, press the corresponding 'Delete Session' button and press confirm on the popup. The session WILL NOT be deleted without pressing confirm.</li>
<li> Please ensure all members who are booked into a session are informed of any session changes or deletions. </li>
</ul>


    {% csrf_token %}
    <input class="invisible" type="text" id="update-field" name="update-field">
    <input class="invisible" type="text" id="delete-field" name="delete-field">
    <input class="invisible" type="text" id="create-field" name="create-field">
    <input class="invisible" type="text" id="feedback-field" name="feedback-field" value="{{ feedback_field }}">
    <label for="date-filter">Date:</label>
    <input class="filter" type="date" id="dat-filter" name="date-filter" value="{{ date_filter }}">
    <label for="activity-filter">Activity: </label>
    <select class="filter" id="act-filter" name="activity-filter" value="{{ activity_filter }}">
        <option class="activity-option" value="All">All</option>
        {% for activity in activities %}
        {% if activity.name == activity_filter %}
            <option value = "{{ activity.name }}" selected>{{ activity.name }}</option>
        {% else %}
        <option value="{{ activity.name }}">{{ activity.name }}</option>
        {% endif %}
        {% endfor %}
    </select>
    <label for="location-filter">Location:</label>
    <select class="filter" id="loc-filter" name="location-filter" value="{{ location_filter }}">
        <option value="All">All</option>
        {% for location in locations %}
        {% if location == location_filter %}
            <option value = "{{ location }}" selected>{{ location }}</option>
        {% else %}
        <option value="{{ location }}">{{ location }}</option>
        {% endif %}
        {% endfor %}
    </select>
  </div>
    <div id="admin-headers" class="container session-box">
      <div class="row">
        <div id="session-headers" class="row">
          <div class="col-xl-2 col-3">Activity 
              {%if activity_filter != "All" %}
              <button type="button" id="act-filter-icon" class="filter-icon admin-btn"><i class="fa-solid fa-filter-circle-xmark"></i></button>
              {% else %}
              <button type="button" id="act-filter-icon" class="filter-icon admin-btn invisible"><i class="fa-solid fa-filter-circle-xmark"></i></button>
              {% endif %}
          </div>
          <div class="col-xl-1 col-2">Date
              {%if date_filter != "" %}
              <button type="button" id="dat-filter-icon" class="filter-icon admin-btn"><i class="fa-solid fa-filter-circle-xmark"></i></button>
              {% else %}
              <button type="button" id="dat-filter-icon" class="filter-icon admin-btn invisible"><i class="fa-solid fa-filter-circle-xmark"></i></button>
              {% endif %}
          </div>
          <div class="col-xl-1 col-1">Time</div>
          <div class="col-xl-2 col-2">Location:
              {%if location_filter != "All" %}
              <button type="button" id="loc-filter-icon" class="filter-icon admin-btn"><i class="fa-solid fa-filter-circle-xmark"></i></button>
              {% else %}
              <button type="button" id="loc-filter-icon" class="filter-icon admin-btn invisible"><i class="fa-solid fa-filter-circle-xmark"></i></button>
              {% endif %}               
          </div>
          <div class="col-xl-1">Spaces</div>
          <div class="col-xl-1">Running</div>
          <div class="col-xl-1">Save</div>
          <div class="col-xl-1">Delete</div>
      </div>
      </div>
    </div>
    <div id="session-cont" class="container session-box">
        {% for session in sessions %}
        <div class="row">
            <div class="col-xl-2 col-3">
                <select id="{{ session.id }}-activity" name="{{ session.id }}-activity">
                    {% for activity in activities %}
                    {% if activity == session.activity %}
                    <option value="{{ activity.name }}" selected>{{ activity.name }}</option>
                    {% else %}
                    <option value="{{ activity.name }}">{{ activity.name }}</option>
                    {% endif %}
                    {% endfor %}
                    </select>
            </div>
            <div class="col-xl-1 col-2">
                <input class="date-edit" type="date" id="{{ session.id }}-date" name="{{ session.id }}-date" value="{{ session.date|date:'Y-m-d' }}">
            </div>
            <div class="col-xl-1 col-1">
                <input type="time" id="{{ session.id }}-time" name="{{ session.id }}-time" value="{{ session.time|time:'H:i' }}" step="3660">
            </div>
            <div class="col-xl-2 col-2">
                <select id="{{ session.id }}-location" name="{{ session.id }}-location">
                    {% for location in locations %}
                    {% if location == session.location %}
                    <option value="{{ location }}" selected>{{ location }}</option>
                    {% else %}
                    <option value="{{ location }}">{{ location }}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="col-xl-1 col-1">
                <input type="number" id="{{ session.id }}-spaces" name="{{ session.id }}-spaces" value="{{ session.spaces }}" min="0" max="25" step="1">
            </div>
            <div class="col-xl-1 col-1">
                {% if session.running %}
                <input type="checkbox" id="{{ session.id }}-running" name="{{ session.id }}-running" checked>
                {% else %}
                <input type="checkbox" id="{{ session.id }}-running" name="{{ session.id }}-running">
                {% endif %}                
            </div>
            <div class="col-xl-2 col-1">
                <button class="admin-btn" type="button"  name="{{ session.id }}-update" data-toggle="modal" data-target="#confirm-update-modal-{{ session.id }}">
                  <p class="action-icon"><i class="fa-solid fa-floppy-disk"></i></p><p class="action-txt">Save Changes</p>
                </button>
            </div>
            
            <div class="col-xl-2 col-1">
                <button class="admin-btn" type="button"  name="{{ session.id }}-delete" data-toggle="modal" data-target="#confirm-delete-modal-{{ session.id }}">
                  <p class="action-icon"><i class="fa-solid fa-trash-can"></i></p><p class="action-txt">Delete</p>
                </button>
            </div>
        </div>
        <!-- Confirm Update Modal -->
<div class="modal fade" id="confirm-update-modal-{{ session.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Are you sure you want to make changes to this session?</h5>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No, discard changes.</button>
          <button type="button" class="btn btn-primary update-btn" id="{{ session.id }}-update">Yes, save changes.</button>
        </div>
      </div>
    </div>
  </div>
          <!-- Confirm Delete Modal -->
<div class="modal fade" id="confirm-delete-modal-{{ session.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Are you sure you want to delete this session from the timetable?</h5>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No, keep the session.</button>
          <button type="button" class="btn btn-primary delete-btn" id="{{ session.id }}-delete">Yes, delete.</button>
        </div>
      </div>
    </div>
  </div>
        {% endfor %}
</div>
<div class="container vertical-margin">
  <div id="add-btn-section" class="row">
    <button class="admin-btn" type="button" id="add-session"><i class="fa-solid fa-square-plus"></i> Add Session</button>  
  </div>
</div>


</form>
          <!-- Confirm Create Modal -->
          <div class="modal fade" id="confirm-create-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Are you sure you want to create this session?</h5>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                  <button type="button" class="btn btn-primary" id="create-btn-modal">Yes</button>
                </div>
              </div>
            </div>
          </div>

<!-- Feedback modal -->
<button type="button" data-toggle="modal" data-target="#feedback-modal" id="feedback-modal-btn" class="invisible"></button>
<div class="modal fade" id="feedback-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="feedback-modal-title">
            {{ feedback }}
          </h5>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">View Sessions</button>
        </div>
      </div>
    </div>
  </div>

<div id="activity-list" class="invisible">
    {% for activity in activities %}
    <p>{{ activity }}</p>
    {% endfor %}
</div>

<div id="location-list" class="invisible">
    {% for location in locations %}
    <p>{{ location }}</p>
    {% endfor %}
</div>

<p class="invisible" id="max-id">{{ max_id }}</p>
<p class="invisible" id="default-date">{{ date_filter }}</p>
{% endblock %}


{% block contentscript %}

<script src="../../static/classbooking_app/js/admin.js"></script>

{% endblock %}